<?xml version="1.0"?>
<launch>
  <arg name="rviz" default="true" />

  <!-- Gazebo с миром дома -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="world_name" value="$(find turtlebot3_gazebo)/worlds/turtlebot3_house.world"/>
    <arg name="paused" value="false"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="gui" value="true"/>
    <arg name="headless" value="false"/>
    <arg name="debug" value="false"/>
  </include>

  <!-- Модель TurtleBot3 -->
  <param name="robot_description"
         command="$(find xacro)/xacro '$(find turtlebot3_description)/urdf/turtlebot3_burger.urdf.xacro'"/>

  <!-- Спавн робота -->
  <node pkg="gazebo_ros" type="spawn_model" name="spawn_urdf"
        args="-urdf -model turtlebot3_burger -param robot_description -x -2.0 -y -0.5 -z 0.0"/>

  <!-- КОНТРОЛЛЕРЫ - используем НАШ конфиг -->
  <rosparam file="$(find study_pkg)/config/gazebo_controller.yaml" command="load"/>
  <node pkg="controller_manager" type="spawner" name="controller_spawner"
        args="joint_state_controller mobile_base_controller"/>

  <!-- Публикация TF -->
  <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher">
    <param name="publish_frequency" type="double" value="50.0" />
  </node>

  <!-- Наш gmapping -->
  <include file="$(find study_pkg)/launch/turtlebot3_my_gmapping.launch" />

  <!-- Управление -->
  <node pkg="turtlebot3_teleop" type="turtlebot3_teleop_key" name="teleop_keyboard" output="screen"/>

  <!-- Rviz -->
  <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz" 
        args="-d $(find study_pkg)/rviz/sim_mapping.rviz"/>
</launch>